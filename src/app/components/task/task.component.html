<hr>

<div class="task-container">
  <h2>Nouvelle tÃ¢che</h2>
  <input type="text" [(ngModel)]="newTaskTitle" placeholder="Titre" />
  <input type="text" [(ngModel)]="newTaskDescription" placeholder="Description" />

  <select [(ngModel)]="newTaskStatus">
    <option *ngFor="let status of ['PENDING','IN_PROGRESS','COMPLETED']" [value]="status">
      {{ status }}
    </option>
  </select>

  <select [(ngModel)]="newTaskPriority">
    <option *ngFor="let priority of ['LOW','MEDIUM','HIGH']" [value]="priority">
      {{ priority }}
    </option>
  </select>

  <input type="date" [(ngModel)]="newTaskDueDate" placeholder="Date limite" />

  <button class="btn add" type="button" (click)="addTask()">Ajouter</button>
</div>

<hr>

<div class="task-container">
  <h2>Liste des tÃ¢ches</h2>
  <div *ngIf="tasks.length > 0; else noTasks">
    <div class="task-card" *ngFor="let task of tasks">

      <!-- âœï¸ Mode Ã©dition -->
      <div *ngIf="editingTask && editingTask.id === task.id; else viewModeTask">
        <input type="text" [(ngModel)]="editingTask.title" placeholder="Titre" />
        <input type="text" [(ngModel)]="editingTask.description" placeholder="Description" />
        <select [(ngModel)]="editingTask.status">
          <option *ngFor="let status of ['PENDING','IN_PROGRESS','COMPLETED']" [value]="status">
            {{ status }}
          </option>
        </select>
        <select [(ngModel)]="editingTask.priority">
          <option *ngFor="let priority of ['LOW','MEDIUM','HIGH']" [value]="priority">
            {{ priority }}
          </option>
        </select>
        <input type="date" [(ngModel)]="editingTask.dueDate" placeholder="Date limite" />

        <div class="task-actions">
          <button class="btn save" type="button" (click)="saveEdit()">ğŸ’¾ Sauvegarder</button>
          <button class="btn cancel" type="button" (click)="cancelEdit()">âŒ Annuler</button>
        </div>
      </div>

      <!-- ğŸ‘ï¸ Mode affichage -->
      <ng-template #viewModeTask>
        <p><strong>{{ task.title }}</strong></p>
        <p>{{ task.description }}</p>
        <small>Status: <span [ngClass]="{'overdue': isOverdue(task)}">{{ task.status }}</span></small>
        <small>Priority: {{ task.priority }}</small><br>
        <small *ngIf="task.dueDate">Due: {{ task.dueDate | date:'shortDate' }}</small>
        <small *ngIf="task.completedAt">TerminÃ© le: {{ task.completedAt | date:'short' }}</small>

        <div class="task-actions">
          <button class="btn edit" type="button" (click)="startEditing(task)">âœï¸ Modifier</button>
          <button class="btn delete" type="button" (click)="deleteTask(task)">ğŸ—‘ï¸ Supprimer</button>
          <button class="btn add" type="button" (click)="completeTask(task)" [disabled]="task.completed">âœ” Terminer</button>
        </div>
      </ng-template>

    </div>
  </div>

  <ng-template #noTasks>
    <p class="no-notes">Aucune tÃ¢che pour ce rendez-vous.</p>
  </ng-template>
</div>
